+++
title = 'Как у меня данные на диске пропали и как я их восстанавливал'
date = 2023-11-29T13:33:55+03:00
draft = false
+++
Всех приветствую! Сегодня предлагаю учиться на опыте и ошибках других (моих).

Последние несколько дней мне приходится засыпать под шум 8 вентиляторов моего ПК, мало того, что они шумят, так они еще и светятся всеми цветами радуги. Когда я думал, что буду тусоваться каждую ночь на шумных дискотеках- я имел ввиду не это. Почему так происходит, вы наверняка уже примерно представляете из названия статьи. Один из моих жестких дисков пал смертью храбрых.

### Как это было

Ничего не предвещало беды, ко мне приехал новый роутер, я планировал поставить его вразрез моего нынешнего роутера и ПК, чтобы создать быструю локальную сеть между моим компьютером и VR шлемом (Assetto Corsa Competizione и Dirt Rally 2.0 сами в себя не сыграют в режиме VR!). Сказано-сделано, втыкаю кабель от старого роутера у WAN порт нового, ПК подключаю в один из портов локальной сети. Сети нет. Лезу в веб-морду роутера, там всё чудесно, решительно не ясно, в чем проблема. "Ну и ладно, ну и не надо" - думаю я и перезагружаюсь в Linux и тем самым получаю доху удивления, но роутер автоматически подхватывает сеть и начинает работать. На самом деле я успел его еще и перепрошить с OpenWRT на стоковую заводскую прошивку и настроил  WiFi. Тем не менее, в Windows без перезагрузки это не заработало. Раскрою название роутера, вдруг кто с таким же столкнется: Radmi AX6S, тот, который китаец (модель RB3, см ветку на форуме 4PDA).

Итак, в Linux Mint всё завелось, локалка поднялась, доступ к Интернету с ПК есть- счастье же, гружусь обратно в Windows. А вот не гружусь. Процесс не двигается дальше "бублика".

![](images/Pasted%20image%2020231119222742.png#center)

**Аналогичную ситуацию можно наблюдать, если диск с установленным Windows перенести на другую конфигурацию железа, в частности, на другой чипсет.** В этом случае Windows обнаружит, что у неё нет необходимых драйверов для чипсета и откажется грузиться дальше. Подумал я, что в этом и проблема: слетел драйвер. Обычно, это решается методом подключения установочного образа и установкой необходимых драйверов с него. Есть вероятность, что в этом случае поставятся Genericд драйвера, но ничего страшного. Нам то нужно, чтобы сработало. Не буду вас томить, это мне не помогло, установочная Windows отказалась восстанавливать мою систему, сославшись на неизвестную ошибку. Зато мне помогли перезагрузки. В очередной раз, после того, как я вновь нагуглил новое решение своей проблемы и спешил его опробовать, я грузился в Widnows и она заработала. Последующие перезагрузки прошли штатно.

И вот, позабыв о минувших проблемах и препятствиях, практически в ходе заднего сальто я попадаю в проводник Windows, что- то цепляет мой взгляд. Ничего не понятно, что не так? И вот, я замечаю, что в проводнике как- то маловато дисков. Из моих 6 носителей отображаются только 5...

### Проблема

Корни той проблемы становятся ясны, диск умирал, тем самым Windows не могла работать. Windows в своём репертуаре: ни логов, ни загрузки. Остался с этой системой 1 на 1 - сиди смотри в темный экран и бублик. Вспомнилось мне, что Mint при старте неоднократно сигнализировал мне в консоли о проблеме с блочным устройством (как понимаете, особо я туда не смотрел, потому что даже только что установленный линукс наверняка выведет сообщение о какой- нибудь ошибке).

Вышел из строя один диск из шести, вроде бы и ничего страшного? Как бы да, но нет. Я давно откладывал создание аналога зеркалирующего рейда, который работал бы поверх файловой системы, для важных файлов. Во мне теплилась надежда о том, что раз уж диск проработал больше пары лет- он уже не может выйти из строя мгновенно. По моему плану диск должен был бы медленно кряхтеть и уходить в мир иной, а я, заметив это, стянул бы с него все нужные файлы, чтобы отправить его на покой.

**Оказалось, что нет**, ничего не гарантировано и жесткий диск, ровно так же, как и твердотельный накопитель, может выйти из строя в один момент. И **SMART не панацея**, вот статистика этого диска в момент написания мной этого поста, сейчас я уже смог восстановить свои данные:

![](images/Pasted%20image%2020231119224749.png#center)

На "жёлтенький" не обращайте внимания, с ним всё в порядке (но скоро придется и с ним расстаться, у него растёт число переназначенных секторов). Рассмотрим диск H: чудесный синий WD на терабайт, с ним всё хорошо, не считая наработки в 18000 часов. Никаких предпосылок. Правда, Windows отказывается его форматировать, а CrystalDiskInfo получает из него SMART за 20-30 секунд, а это не нормально долго. **Попробую с ним еще что- то сделать, но не думаю, что получится, скорее всего, он труп.**

### Шаги по решению проблемы

Когда я обнаружил неправомерное хищение средства постоянного хранения информации из своей электронной вычислительной машины, я отправился в стандартную утилиту Windows.
![](images/Pasted%20image%2020231119225442.png#center)

Мой диск нашелся внутри графического интерфейса. Стоит заметить, что он у меня был динамическим (когда- то я двигал разделы на нём и кажется, именно для этого нужно было сделать его динамическим), а рядом с его иконкой красовалась надпись "Ошибки". Microsoft на [официальной странице](https://learn.microsoft.com/ru-ru/troubleshoot/windows-server/backup-and-storage/troubleshoot-disk-management#a-dynamic-disks-status-is-online-errors) в ситуации сочетания понятий "динамический диск" и "Ошибки" нажать на него правой кнопкой мыши и переинициализировать/активировать его. **Мне это не помогло.** В той ситуации программы по восстановлению данных отказывались с ним работать, не могу сказать точно, почему, во всяком случае утилиты Recuva и ещё какая- то игнорировали мой диск. Мне ничего не оставалось сделать, кроме как нажать правой кнопкой мыши и нажать на кнопку "Преобразовать в базовый диск". Это я и сделал.

***

Если вы оказались в аналогичной ситуации: первое, что вам нужно сделать- попытаться снять побитовый образ всего диска. Процесс восстановления данных с диска занимает длительное время, а за это время диск может окончательно перестать отвечать на команды. Для снятия побитовых копий существует много утилит и вам следует сделать обзор того, какие они бывают и что они делают, а также как потом можно работать с результатами их работы. **Я совершил ошибку и не стал делать битовую копию. Мне сильно повезло, что всё обошлось.**

***

После преобразования диска в базовый, на нём стал отображаться один раздел с файловой системой RAW, форматировать его не надо. Это несколько развязало мне руки, теперь я мог заняться поиском утраченных файлов.

### Утилиты по восстановлению данных. Рекомендация

Первым делом я попробовал запустить сканирование утилитой **EaseUS**, за ночь работы она смогла сформировать отчет по найденным файлам, но после моего запроса на восстановление пары папок- она зависла на пару часов, отожрав солидную часть ресурсов моего процессора. Windows была совершенно не против прикончить программу, ссылаясь на то, что она "долго не отвечает". Ужасный UX дизайн, пользователь испытывает весь спектр негативных эмоций из- за того, что его данные потерялись, тут у него появляется лучик надежды, он видит свои файлики в окне программы, но когда он хочет их восстановить- всё зависает. Даже предупреждения не было о том, что программа может выглядеть "зависшей". По итогу, она подумала- подумала и я сохранил свои файлики. **Жаль, что все они оказались битыми.**

Коллега на работе посоветовал мне программу [DMDE](https://dmde.ru/) (DM Disk Editor and Data Recovery Software). Скажу сразу- именно она и помогла мне. В программке нужно выбрать диск или раздел, начать сканирование, по окончанию сканирования следует обязательно сохранить лог в файл, чтобы иметь возможность его загрузить в будущем, не ожидая повторного сканирования (порядка нескольких часов на терабайт). После сканирования можете восстанавливать файлы, но для этого программе потребуется создать виртуальную файловую систему, чтобы можно было мышью тыкать по файлам и восстанавливать их. Как экспортировать эту виртуальную ФС я не нашёл, но это было бы полезно, поскольку после закрытия программа забывает про неё, а процесс создания этой ФС отнюдь не быстр (минут 30 - 60).

### Заключение

Очень мне нравится одна притча.

Инструктор по самообороне спрашивает у курсантов, что нужно делать в ситуации, когда на вас направлен пистолет. Раздаются какие угодно ответы, но ни один не нравится инструктору. Выслушав все варианты, инструктор начал говорить: "Если на вас направлен пистолет, то первым делом надо подумать, как вы очутились в ситуации, в которой на вас направлен пистолет. Неужели ни за неделю, день, пару часов, 10 или 5 минут ничего не предвещало этого?"

**Также и с дисками и данными, неужели нельзя было ничего сделать за год, месяц, неделю до того, как рисковать потерей важной информации?**

В следующем посте разберемся с созданием ПХД (программного хранилища данных). Чтобы не переживать из- за отказавшего жесткого диска. Думаю, воспользуемся утилитой **FreeFileSync**, но это не точно.

### Послесловие

Оказалось, что у меня вышел из строя SATA-кабель, которым был подключен мой павший жесткий диск. Сегодня я убил еще два кабеля, пока я с дисками возился в компьютере. Оказывается, они с возрастом становятся крайне хрупкими, рассыхаются, видимо. В общем, быть может, не надо сразу бросаться со средствами форматирования и восстановления данных на диск 🙃.

![](images/sata.jpg#center)
